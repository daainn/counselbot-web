{% load static %}
<link rel="stylesheet" href="{% static 'css/modal_feedback.css' %}">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/pretendard.css">

<!-- 사이드바 -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-header-bar">
    <button id="sidebarToggle" class="chat-sidebar-btn">
      <img src="{% static 'images/sidebar.png' %}" alt="사이드바 열기">
    </button>
    <a href="{% url 'chat:main' %}" class="chat-new-btn">
      <img src="{% static 'images/new-chat.png' %}" alt="새 채팅">
    </a>
  </div>

  {% if current_chat %}
    <div class="current-chat">
      <img src="{% static 'images/chat-history.png' %}" alt="기록 아이콘">
      <span>{{ current_chat.chat_title|truncatechars:10 }}</span>
      <span class="chat-active-indicator"></span>
    </div>
  {% endif %}

  <hr class="sidebar-divider">

  {% if not is_guest %}
    {% if chat_list %}
      <div class="sidebar-date-label">지난 채팅 기록</div>
      {% for c in chat_list %}
        <div class="question-item{% if current_chat and current_chat.id == c.id %} active{% endif %}" id="chat-{{ c.id }}">
          <div class="question-info" onclick="location.href='{% url 'chat:chat_talk_detail' c.id %}'">
            <img src="{% static 'images/chat-history.png' %}" alt="채팅 아이콘">
            <input
              class="question-text"
              type="text"
              id="chat-title-{{ c.id }}"
              name="title"
              value="{{ c.chat_title|truncatechars:10 }}"
              readonly />
          </div>
          <div class="question-icons">
            <i class="fas fa-pencil-alt" onclick="editChatTitle({{ c.id }})" title="제목 수정"></i>
            <i class="fas fa-trash" onclick="deleteChat({{ c.id }})" title="삭제하기"></i>
            <span class="chat-active-indicator"></span>
          </div>
        </div>
      {% endfor %}
    {% else %}
      <p class="guest-info-message">상담 기록이 없습니다.</p>
    {% endif %}
  
    {% else %}
    <div class="guest-info-message">
      <p>
        아직 회원이 아니신가요?<br>회원가입 후 로그인하시면<br>이전 채팅 기록을 다시 조회할 수 있어요
      </p>
      <a href="{% url 'user:join_01' %}" class="guest-login-btn">회원가입 하기</a>
      <a href="{% url 'user:home' %}" class="guest-login-btn">로그인 하기</a>
    </div>
    {% endif %}



      <div class="sidebar-settings">

      <img src="{% static 'images/settings.png' %}" class="sidebar-user-icon" id="sidebarUserIcon" alt="유저 아이콘">

      <div class="chat-dropdown-menu" id="sidebarDropdownMenu">
        {% if is_guest %}
          <a href="#" class="open-modal" data-url="{% url 'user:modal_feedback' %}">의견 보내기</a>
          <a href="{% url 'user:home' %}">로그인</a>
        {% else %}
          <p class="chat-user-email">{{ user_user_email }}</p>
          <a href="#" class="open-modal" data-url="{% url 'user:modal_update' %}">회원정보 수정</a>
          <a href="#" class="open-modal" data-url="{% url 'user:modal_feedback' %}">의견 보내기</a>
          <a href="{% url 'user:logout' %}">로그아웃</a>
        {% endif %}
      </div>
    </div>

  </div>


</div>

<!-- 아이콘용 FontAwesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const icon = document.getElementById('chatUserIcon');
    const menu = document.getElementById('chatDropdownMenu');

    icon.addEventListener('click', function (e) {
      e.stopPropagation();
      menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
    });

    // 외부 클릭 시 드롭다운 닫기
    document.addEventListener('click', function () {
      menu.style.display = 'none';
    });
  });

    
  </script>
  <!-- 공통 스크립트 -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script>
  $(document).ready(function() {
    $('.open-modal').click(function(e) {
      e.preventDefault();
      const url = $(this).data('url');

      $.get(url, function(data) {
        $('#modalContent').html(data);
        $('#dynamicModal').fadeIn();
      });
    });

    $(document).on('click', '.modal-close', function() {
      $('#dynamicModal').fadeOut();
      $('#modalContent').html('');
    });

   });
  </script>

